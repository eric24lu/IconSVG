name: Convert SVG to PNG

on:
  workflow_dispatch:
  push:
    paths:
      - '*.svg'

jobs:
  convert:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y inkscape
      
      - name: Convert SVG files to PNG
        run: |
          for svg in HK.svg CN.svg JP.svg SG.svg US.svg UN.svg; do
            if [ -f "$svg" ]; then
              png="${svg%.svg}.png"
              echo "Converting $svg to $png..."
              inkscape "$svg" --export-type=png --export-filename="$png" --export-width=320 --export-height=320
            fi
          done
      
      - name: Create icon-pack.json
        run: |
          cat > icon-pack.json << 'EOF'
          [
            {
              "name": "CN",
              "label": "China",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/CN.png"
            },
            {
              "name": "HK",
              "label": "Hong Kong",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/HK.png"
            },
            {
              "name": "JP",
              "label": "Japan",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/JP.png"
            },
            {
              "name": "SG",
              "label": "Singapore",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/SG.png"
            },
            {
              "name": "US",
              "label": "United States",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/US.png"
            },
            {
              "name": "UN",
              "label": "United Nations",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/UN.png"
            },
            {
              "name": "YouTube",
              "label": "YouTube",
              "url": "https://raw.githubusercontent.com/eric24lu/IconSVG/main/YouTube.png"
            }
          ]
          EOF
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add *.png icon-pack.json
          git diff --staged --quiet || git commit -m "Convert SVG files to PNG and create icon-pack.json"
          git push
